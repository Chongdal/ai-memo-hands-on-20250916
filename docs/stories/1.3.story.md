# Story 1.3: 비밀번호 재설정

## Status

Ready for Development

## 📋 요약

사용자가 비밀번호를 잊어버렸을 때 이메일을 통해 안전하게 비밀번호를 재설정할 수 있는 기능을 구현합니다. Supabase Auth의 비밀번호 재설정 기능을 활용하여 보안성과 사용자 경험을 모두 확보합니다.

**스토리 포인트:** 3점
**예상 소요 시간:** 1-2일

## Story

**As a** 등록된 사용자,
**I want** 비밀번호를 잊어버렸을 때 이메일을 통해 비밀번호를 재설정할 수 있는 기능,
**so that** 비밀번호를 잊어도 내 계정에 다시 접근할 수 있다.

## Acceptance Criteria

1. "비밀번호 찾기" 페이지에서 이메일 주소 입력 필드가 제공되어야 한다
2. 이메일 형식 검증이 클라이언트 사이드에서 이루어져야 한다
3. 등록되지 않은 이메일 입력 시에도 보안상 동일한 성공 메시지가 표시되어야 한다
4. 비밀번호 재설정 이메일이 발송된 후 안내 메시지가 표시되어야 한다
5. 이메일의 재설정 링크 클릭 시 새 비밀번호 입력 페이지로 이동해야 한다
6. 새 비밀번호 입력 페이지에서 비밀번호 강도 검증이 이루어져야 한다
7. 비밀번호 재설정 완료 후 로그인 페이지로 리다이렉트되어야 한다
8. 만료된 재설정 링크에 대한 적절한 에러 처리가 이루어져야 한다

## Tasks / Subtasks

-   [ ] 비밀번호 찾기 UI 컴포넌트 구현 (AC: 1, 2, 4)
    -   [ ] 비밀번호 찾기 폼 레이아웃 생성 (이메일 입력 필드)
    -   [ ] 이메일 형식 유효성 검사 로직 구현
    -   [ ] 성공 메시지 및 안내 UI 구현
    -   [ ] 로딩 상태 및 에러 상태 UI 처리
-   [ ] 비밀번호 재설정 서버 액션 구현 (AC: 3, 4)
    -   [ ] forgotPassword 서버 액션 생성
    -   [ ] Supabase Auth resetPasswordForEmail 메서드 호출
    -   [ ] 보안을 위한 일관된 응답 처리
    -   [ ] 에러 핸들링 및 사용자 친화적 메시지
-   [ ] 비밀번호 찾기 페이지 구현 (AC: 1)
    -   [ ] `/forgot-password` 라우트 생성
    -   [ ] 이미 로그인된 사용자 접근 제어
    -   [ ] 로그인 페이지로 돌아가기 링크 추가
-   [ ] 새 비밀번호 설정 UI 구현 (AC: 5, 6, 7)
    -   [ ] 새 비밀번호 입력 폼 컴포넌트 생성
    -   [ ] 비밀번호 강도 검증 및 확인 필드
    -   [ ] 비밀번호 표시/숨기기 토글 기능
-   [ ] 새 비밀번호 설정 페이지 구현 (AC: 5, 7, 8)
    -   [ ] `/reset-password` 라우트 생성
    -   [ ] URL 파라미터에서 토큰 추출 및 검증
    -   [ ] 만료된 토큰 에러 처리
    -   [ ] 성공 시 로그인 페이지로 리다이렉트
-   [ ] 기존 페이지 연동
    -   [ ] 로그인 페이지의 "비밀번호 찾기" 링크 연결 확인
    -   [ ] 이메일 템플릿 커스터마이징 (선택사항)
-   [ ] 테스트 구현
    -   [ ] 비밀번호 찾기 폼 유효성 검사 단위 테스트
    -   [ ] 비밀번호 재설정 플로우 통합 테스트
    -   [ ] 에러 케이스 테스트 (만료된 토큰, 잘못된 토큰)
    -   [ ] 보안 테스트 (존재하지 않는 이메일 처리)

## Dev Notes

### 이전 스토리 인사이트

[Source: Story 1.1, 1.2 - 완료된 구현 사항]

-   ✅ Supabase 클라이언트 설정 완료 (`lib/supabase.ts`)
-   ✅ 인증 서버 액션 기반 구조 구축 (`lib/actions/auth.ts`)
-   ✅ shadcn/ui 컴포넌트 시스템 도입 (`components/ui/`)
-   ✅ 폼 유효성 검사 패턴 확립 (`lib/validations/auth.ts`)
-   ✅ 일관된 에러 핸들링 및 사용자 친화적 메시지 패턴
-   ✅ 로그인 페이지에 "비밀번호 찾기" 링크 이미 구현됨
-   ✅ 환경 변수 설정 완료

### 기술 스택 정보

[Source: docs/architecture.md#1-기술-스택]

-   **프레임워크:** Next.js (App Router, Server Actions)
-   **UI:** shadcn/ui + Tailwind + Radix UI
-   **DB/인증:** Supabase (Postgres, Auth, Storage)

### 보안 요구사항

[Source: docs/architecture.md#3-보안]

-   Supabase 서비스 롤 키는 서버 전용으로 사용
-   사용자 ID 스코프로 권한 제어
-   비밀번호 재설정 시 보안 고려사항:
    -   존재하지 않는 이메일에도 동일한 응답 제공
    -   토큰 만료 시간 적절히 설정
    -   재설정 후 기존 세션 무효화

### 프로젝트 구조

-   비밀번호 찾기 페이지: `app/forgot-password/page.tsx` (새로 생성)
-   새 비밀번호 설정 페이지: `app/reset-password/page.tsx` (새로 생성)
-   비밀번호 찾기 폼: `components/auth/forgot-password-form.tsx` (새로 생성)
-   새 비밀번호 설정 폼: `components/auth/reset-password-form.tsx` (새로 생성)
-   기존 인증 액션 확장: `lib/actions/auth.ts` (forgotPassword, resetPassword 함수 추가)
-   기존 유효성 검사 스키마 확장: `lib/validations/auth.ts`

### Supabase Auth 구성

-   기존 Supabase 설정 활용
-   `resetPasswordForEmail` 메서드 사용
-   `updateUser` 메서드로 새 비밀번호 설정
-   이메일 템플릿 설정 (Supabase 대시보드에서)
-   리다이렉트 URL 설정: `${NEXT_PUBLIC_SITE_URL}/reset-password`

### 환경 변수 요구사항

[Source: Story 1.1, 1.2 - 이미 설정 완료]

-   ✅ `NEXT_PUBLIC_SUPABASE_URL`
-   ✅ `NEXT_PUBLIC_SUPABASE_ANON_KEY`
-   ✅ `SUPABASE_SERVICE_ROLE_KEY`
-   ✅ `NEXT_PUBLIC_SITE_URL` (비밀번호 재설정 리다이렉트용)

### 재사용 가능한 컴포넌트

-   `components/ui/button.tsx` - 제출 버튼용
-   `components/ui/input.tsx` - 이메일/비밀번호 입력
-   `components/ui/label.tsx` - 폼 레이블
-   `components/ui/card.tsx` - 폼 컨테이너
-   기존 비밀번호 강도 검증 로직 재사용

### 보안 고려사항

1. **이메일 열거 공격 방지**: 존재하지 않는 이메일에도 성공 메시지 표시
2. **토큰 보안**: 일회용 토큰 사용, 적절한 만료 시간 설정
3. **세션 관리**: 비밀번호 변경 후 기존 세션 무효화
4. **브루트 포스 방지**: 재설정 요청 제한 (Supabase에서 자동 처리)

### Testing

#### 테스트 표준

[Source: docs/architecture.md#6-배포운영]

-   테스트 프레임워크: Jest + React Testing Library
-   테스트 파일 위치: `__tests__/` 디렉토리
-   단위 테스트와 통합 테스트 모두 구현
-   Supabase Auth 목킹 필요

#### 특별 테스트 케이스

-   존재하지 않는 이메일 처리
-   만료된 재설정 토큰 처리
-   잘못된 형식의 토큰 처리
-   이미 사용된 재설정 토큰 처리

## Change Log

| Date       | Version | Description      | Author           |
| ---------- | ------- | ---------------- | ---------------- |
| 2025-09-16 | 1.0     | 스토리 초안 생성 | Scrum Master Bob |

## Dev Agent Record

이 섹션은 개발 에이전트가 구현 중에 채워집니다.

### Agent Model Used

TBD

### Debug Log References

TBD

### Completion Notes List

TBD

### File List

TBD

## QA Results

QA 에이전트가 완료된 스토리 구현을 검토한 결과입니다.

### 완료 일자

TBD

### 최종 테스트 결과

TBD

### 구현 완료된 Acceptance Criteria

TBD
