# Story 2.1: 노트 생성 (제목 + 본문)

## Status

Ready for Development

## 📋 요약

사용자가 제목과 본문을 입력하여 새로운 노트를 생성할 수 있는 기본 CRUD 기능을 구현합니다. 이는 AI 메모장의 핵심 기능으로, 사용자의 아이디어와 정보를 체계적으로 저장할 수 있는 기반을 제공합니다.

**스토리 포인트:** 5점
**예상 소요 시간:** 2-3일

## Story

**As a** 로그인한 사용자,
**I want** 제목과 본문을 입력하여 새로운 노트를 생성할 수 있는 기능,
**so that** 내 아이디어와 정보를 체계적으로 기록하고 관리할 수 있다.

## Acceptance Criteria

1. 노트 생성 페이지에서 제목 입력 필드가 제공되어야 한다
2. 노트 생성 페이지에서 본문 입력 필드(텍스트 에리어)가 제공되어야 한다
3. 제목은 필수 입력 항목이며, 빈 제목으로는 저장할 수 없어야 한다
4. 본문은 선택 입력 항목이며, 빈 본문도 저장 가능해야 한다
5. 노트 저장 시 생성일시와 수정일시가 자동으로 기록되어야 한다
6. 저장된 노트는 로그인한 사용자만 접근할 수 있어야 한다 (RLS 적용)
7. 저장 성공 시 노트 목록 페이지로 리다이렉트되어야 한다
8. 저장 중 로딩 상태가 표시되어야 한다
9. 저장 실패 시 적절한 에러 메시지가 표시되어야 한다
10. 취소 버튼 클릭 시 노트 목록 페이지로 이동해야 한다

## Tasks / Subtasks

-   [ ] 데이터베이스 스키마 설계 및 구현 (AC: 5, 6)
    -   [ ] Drizzle ORM 스키마 정의 (`lib/db/schema.ts`)
    -   [ ] notes 테이블 생성 (id, user_id, title, content, created_at, updated_at)
    -   [ ] RLS 정책 설정 (사용자별 데이터 격리)
    -   [ ] 데이터베이스 마이그레이션 실행
-   [ ] 노트 생성 서버 액션 구현 (AC: 3, 4, 5, 6, 9)
    -   [ ] createNote 서버 액션 생성 (`lib/actions/notes.ts`)
    -   [ ] 제목 필수 검증 로직 구현
    -   [ ] 사용자 인증 상태 확인
    -   [ ] 데이터베이스 저장 로직 구현
    -   [ ] 에러 핸들링 및 사용자 친화적 메시지
-   [ ] 노트 생성 폼 컴포넌트 구현 (AC: 1, 2, 8, 9)
    -   [ ] 제목 입력 필드 구현
    -   [ ] 본문 텍스트 에리어 구현 (자동 높이 조절)
    -   [ ] 폼 유효성 검사 (클라이언트 사이드)
    -   [ ] 로딩 상태 UI 구현
    -   [ ] 에러 상태 UI 구현
    -   [ ] 저장/취소 버튼 구현
-   [ ] 노트 생성 페이지 구현 (AC: 7, 10)
    -   [ ] `/notes/new` 라우트 생성
    -   [ ] 인증되지 않은 사용자 접근 제어
    -   [ ] 성공 시 노트 목록으로 리다이렉트
    -   [ ] 취소 시 노트 목록으로 리다이렉트
    -   [ ] 페이지 메타데이터 설정
-   [ ] 유효성 검사 스키마 구현
    -   [ ] 노트 생성 스키마 정의 (`lib/validations/notes.ts`)
    -   [ ] 제목 길이 제한 (1-200자)
    -   [ ] 본문 길이 제한 (0-10000자)
    -   [ ] XSS 방지를 위한 입력 검증
-   [ ] 기본 노트 목록 페이지 구현 (임시)
    -   [ ] `/notes` 라우트 생성
    -   [ ] 기본 레이아웃 구현
    -   [ ] "새 노트 작성" 버튼 추가
-   [ ] 테스트 구현
    -   [ ] 노트 생성 폼 컴포넌트 단위 테스트
    -   [ ] 노트 생성 서버 액션 통합 테스트
    -   [ ] 유효성 검사 테스트
    -   [ ] 데이터베이스 연동 테스트
    -   [ ] 인증 및 권한 테스트

## Dev Notes

### 이전 스토리 인사이트

[Source: Epic 1 Stories 1.1-1.3 - 완료된 구현 사항]

-   ✅ Supabase 클라이언트 설정 완료 (`lib/supabase.ts`)
-   ✅ 사용자 인증 시스템 완료 (회원가입, 로그인, 비밀번호 재설정)
-   ✅ shadcn/ui 컴포넌트 시스템 도입 (`components/ui/`)
-   ✅ 서버 액션 기반 아키텍처 확립 (`lib/actions/auth.ts`)
-   ✅ 폼 유효성 검사 패턴 확립 (`lib/validations/auth.ts`)
-   ✅ 일관된 에러 핸들링 패턴
-   ✅ 환경 변수 설정 완료

### 기술 스택 정보

[Source: docs/architecture.md#1-기술-스택]

-   **프레임워크:** Next.js (App Router, Server Actions)
-   **UI:** shadcn/ui + Tailwind + Radix UI
-   **DB/인증:** Supabase (Postgres, Auth, Storage)
-   **ORM:** Drizzle ORM (마이그레이션/쿼리)

### 데이터 모델 설계

[Source: docs/architecture.md#2-데이터-모델]

```sql
CREATE TABLE notes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  title VARCHAR(200) NOT NULL,
  content TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- RLS 정책
ALTER TABLE notes ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can only access their own notes" ON notes
  FOR ALL USING (auth.uid() = user_id);
```

### 보안 요구사항

[Source: docs/architecture.md#3-보안]

-   사용자 ID 스코프로 권한 제어 (RLS 정책)
-   XSS 방지를 위한 입력 검증
-   CSRF 보호 (Next.js Server Actions 기본 제공)
-   SQL Injection 방지 (Drizzle ORM 사용)

### 프로젝트 구조

-   노트 생성 페이지: `app/notes/new/page.tsx` (새로 생성)
-   노트 목록 페이지: `app/notes/page.tsx` (기본 구현)
-   노트 생성 폼: `components/notes/note-form.tsx` (새로 생성)
-   노트 서버 액션: `lib/actions/notes.ts` (새로 생성)
-   노트 유효성 검사: `lib/validations/notes.ts` (새로 생성)
-   데이터베이스 스키마: `lib/db/schema.ts` (새로 생성)
-   데이터베이스 설정: `lib/db/index.ts` (새로 생성)

### Drizzle ORM 설정

-   데이터베이스 연결 설정
-   스키마 정의 및 타입 생성
-   마이그레이션 스크립트 설정
-   개발/프로덕션 환경 분리

### 환경 변수 요구사항

[Source: Epic 1 - 이미 설정 완료]

-   ✅ `NEXT_PUBLIC_SUPABASE_URL`
-   ✅ `NEXT_PUBLIC_SUPABASE_ANON_KEY`
-   ✅ `SUPABASE_SERVICE_ROLE_KEY`
-   추가 필요: `DATABASE_URL` (Drizzle ORM용)

### UI/UX 고려사항

-   반응형 디자인 (모바일 우선)
-   텍스트 에리어 자동 높이 조절
-   실시간 문자 수 카운터
-   키보드 단축키 지원 (Ctrl+S 저장)
-   접근성 준수 (ARIA 레이블, 키보드 네비게이션)

### 성능 최적화

-   텍스트 에리어 debounce 처리
-   폼 상태 최적화
-   불필요한 리렌더링 방지
-   이미지 최적화 (향후 첨부파일 기능 대비)

### Testing

#### 테스트 표준

[Source: docs/architecture.md#6-배포운영]

-   테스트 프레임워크: Jest + React Testing Library
-   테스트 파일 위치: `__tests__/` 디렉토리
-   단위 테스트와 통합 테스트 모두 구현
-   데이터베이스 테스트용 별도 환경 구성

#### 특별 테스트 케이스

-   긴 제목/본문 처리
-   특수 문자 입력 처리
-   네트워크 오류 시나리오
-   동시 저장 요청 처리
-   권한 없는 사용자 접근 시도

### 패키지 의존성

새로 추가 필요한 패키지:
-   `drizzle-orm`: ORM 라이브러리
-   `drizzle-kit`: 마이그레이션 도구
-   `@supabase/ssr`: 서버 사이드 Supabase 클라이언트
-   `postgres`: PostgreSQL 드라이버

## Change Log

| Date       | Version | Description      | Author           |
| ---------- | ------- | ---------------- | ---------------- |
| 2025-09-16 | 1.0     | 스토리 초안 생성 | Scrum Master Bob |

## Dev Agent Record

이 섹션은 개발 에이전트가 구현 중에 채워집니다.

### Agent Model Used

TBD

### Debug Log References

TBD

### Completion Notes List

TBD

### File List

TBD

## QA Results

QA 에이전트가 완료된 스토리 구현을 검토한 결과입니다.

### 완료 일자

TBD

### 최종 테스트 결과

TBD

### 구현 완료된 Acceptance Criteria

TBD

