# Story 2.3: 노트 상세 조회 및 자동 저장 기능

## 📋 **Story 개요**
**As a** 로그인한 사용자  
**I want to** 노트를 상세하게 조회하고 수정 중 자동 저장 기능을 사용할 수 있다  
**So that** 노트 내용을 편리하게 확인하고 작업 중 데이터 손실 없이 안전하게 편집할 수 있다  

## 🎯 **수용 기준 (Acceptance Criteria)**

### AC 2.3.1: 노트 상세 조회 기능
- [ ] 노트 목록에서 노트 제목 클릭 시 상세 보기 페이지로 이동한다
- [ ] 상세 페이지에서 노트의 전체 내용을 볼 수 있다
- [ ] 노트 제목, 본문, 생성일, 수정일이 표시된다
- [ ] 읽기 전용 모드와 편집 모드를 전환할 수 있다
- [ ] 편집 모드에서는 제목과 본문을 수정할 수 있다
- [ ] 다른 사용자의 노트는 조회할 수 없다 (404 처리)

### AC 2.3.2: 자동 저장 기능
- [ ] 편집 모드에서 3초간 입력이 없으면 자동으로 저장된다
- [ ] 자동 저장 상태가 UI에 표시된다 ("저장됨", "저장 중...", "저장 실패")
- [ ] 페이지를 벗어나기 전 저장되지 않은 변경사항이 있으면 경고한다
- [ ] 자동 저장은 실제 변경사항이 있을 때만 실행된다
- [ ] 네트워크 오류 시 재시도 로직이 작동한다

### AC 2.3.3: 편집 모드 UX
- [ ] 읽기 모드에서 "편집" 버튼으로 편집 모드 전환
- [ ] 편집 모드에서 "완료" 버튼으로 읽기 모드 전환
- [ ] 편집 모드에서도 Ctrl+S 수동 저장 지원
- [ ] 편집 중인 필드가 시각적으로 구분된다
- [ ] 모바일에서도 편리한 편집 경험 제공

### AC 2.3.4: 네비게이션 및 접근성
- [ ] 브레드크럼 네비게이션 제공 (홈 > 노트 목록 > 노트 제목)
- [ ] 뒤로 가기 버튼으로 노트 목록으로 이동
- [ ] 키보드 네비게이션 지원
- [ ] 스크린 리더 호환성 확보

### AC 2.3.5: 성능 및 최적화
- [ ] 노트 내용이 길어도 빠른 로딩 속도 유지
- [ ] 자동 저장으로 인한 UI 끊김 현상 없음
- [ ] 동시 편집 충돌 방지 (optimistic updates)

## 🏗️ **기술적 구현 사항**

### 1. 데이터베이스 스키마 (기존 유지)
```sql
-- 기존 notes 테이블 사용 (변경 없음)
-- updated_at 필드는 자동 저장 시마다 갱신
```

### 2. API 엔드포인트 (Server Actions)
```typescript
// lib/actions/notes.ts에 추가
export async function getNoteById(noteId: string)  // 기존 함수 활용
export async function updateNotePartial(noteId: string, data: { title?: string; content?: string })
export async function saveNoteDraft(noteId: string, data: { title?: string; content?: string })
```

### 3. 자동 저장 로직
```typescript
// hooks/use-auto-save.ts
export function useAutoSave(
  noteId: string,
  data: { title: string; content: string },
  options: {
    delay?: number  // 기본 3초
    enabled?: boolean
    onSave?: (result: any) => void
    onError?: (error: any) => void
  }
)
```

### 4. 페이지 구조
```
app/
├── notes/
│   ├── [id]/
│   │   ├── page.tsx              # 노트 상세 보기/편집 페이지
│   │   ├── edit/
│   │   │   └── page.tsx          # 기존 편집 전용 페이지 (리다이렉트)
│   │   └── not-found.tsx         # 404 페이지
│   ├── page.tsx                  # 노트 목록
│   └── new/
│       └── page.tsx              # 새 노트 작성
```

### 5. 컴포넌트 구조
```
components/
├── notes/
│   ├── note-detail-view.tsx     # 읽기 모드 컴포넌트
│   ├── note-edit-view.tsx       # 편집 모드 컴포넌트
│   ├── note-auto-save-status.tsx # 자동 저장 상태 표시
│   ├── note-breadcrumb.tsx      # 브레드크럼 네비게이션
│   └── note-view-toggle.tsx     # 읽기/편집 모드 토글
├── ui/
│   ├── breadcrumb.tsx           # 브레드크럼 UI 컴포넌트
│   └── status-indicator.tsx     # 상태 표시 컴포넌트
└── hooks/
    ├── use-auto-save.ts         # 자동 저장 훅
    ├── use-unsaved-changes.ts   # 저장되지 않은 변경사항 감지
    └── use-debounce.ts          # 디바운스 훅
```

## 📝 **구현 작업 목록**

### Phase 1: 백엔드 로직
- [ ] `lib/actions/notes.ts`에 `updateNotePartial` 함수 구현
- [ ] `lib/actions/notes.ts`에 `saveNoteDraft` 함수 구현 (자동 저장용)
- [ ] 부분 업데이트 및 충돌 감지 로직 구현
- [ ] 에러 처리 및 재시도 로직 구현

### Phase 2: 커스텀 훅 구현
- [ ] `hooks/use-debounce.ts` 디바운스 훅 구현
- [ ] `hooks/use-auto-save.ts` 자동 저장 훅 구현
- [ ] `hooks/use-unsaved-changes.ts` 변경사항 감지 훅 구현
- [ ] 브라우저 이벤트 (beforeunload) 처리

### Phase 3: UI 컴포넌트 구현
- [ ] `components/ui/breadcrumb.tsx` 브레드크럼 컴포넌트 구현
- [ ] `components/ui/status-indicator.tsx` 상태 표시 컴포넌트 구현
- [ ] `components/notes/note-detail-view.tsx` 읽기 모드 구현
- [ ] `components/notes/note-edit-view.tsx` 편집 모드 구현
- [ ] `components/notes/note-auto-save-status.tsx` 저장 상태 표시 구현
- [ ] `components/notes/note-breadcrumb.tsx` 노트용 브레드크럼 구현

### Phase 4: 페이지 구현
- [ ] `app/notes/[id]/page.tsx` 상세 페이지 구현
- [ ] 읽기/편집 모드 전환 로직 구현
- [ ] URL 상태 관리 (`?mode=edit`) 구현
- [ ] 기존 편집 페이지 리다이렉트 처리

### Phase 5: 통합 및 최적화
- [ ] 노트 목록에서 상세 페이지로 링크 연결
- [ ] 성능 최적화 (메모이제이션, 불필요한 리렌더링 방지)
- [ ] 접근성 개선 (ARIA 레이블, 키보드 네비게이션)
- [ ] 모바일 반응형 최적화

### Phase 6: 테스트 및 검증
- [ ] 자동 저장 기능 단위 테스트 작성
- [ ] 상세 조회 기능 테스트 작성
- [ ] 편집 모드 전환 테스트 작성
- [ ] E2E 테스트 시나리오 작성 및 실행

## 🔗 **의존성**
- **선행 조건**: Story 2.2 (노트 수정/삭제, 페이지네이션) 완료
- **관련 Epic**: Epic 2 - 노트 관리
- **다음 Story**: Story 2.4 (노트 검색 및 필터링) 또는 Story 3.1 (음성 메모 녹음)

## 📊 **성공 지표**
- [ ] 사용자가 노트를 클릭하여 상세 내용을 볼 수 있다
- [ ] 편집 모드에서 3초 후 자동 저장이 작동한다
- [ ] 저장되지 않은 변경사항이 있을 때 페이지 이탈 경고가 표시된다
- [ ] 모든 기능이 모바일에서도 정상 작동한다
- [ ] 네트워크 오류 시 재시도 로직이 정상 작동한다

## 🎨 **UI/UX 고려사항**
- **읽기 모드**: 깔끔하고 읽기 편한 타이포그래피
- **편집 모드**: 명확한 시각적 구분 (테두리, 배경색 등)
- **자동 저장 상태**: 눈에 띄지 않지만 확인 가능한 위치에 표시
- **브레드크럼**: 현재 위치를 명확히 표시
- **모드 전환**: 직관적인 버튼 위치와 아이콘

## 📱 **반응형 고려사항**
- 모바일에서 편집 모드 시 키보드가 올라와도 UI 깨짐 없음
- 터치 디바이스에서 편리한 편집 경험
- 브레드크럼이 작은 화면에서도 적절히 표시됨

## 🔒 **보안 고려사항**
- 서버 사이드에서 노트 소유권 검증
- 자동 저장 시에도 권한 검증 필수
- XSS 방지를 위한 입력값 sanitization
- CSRF 토큰 검증

## ⚡ **성능 고려사항**
- 자동 저장 요청 최적화 (변경사항이 있을 때만)
- 디바운싱으로 불필요한 API 호출 방지
- 낙관적 업데이트로 빠른 사용자 경험
- 큰 노트 내용에 대한 가상화 고려

---

**추정 개발 시간**: 3-4일  
**우선순위**: High  
**난이도**: Medium-High  
**Story Points**: 13

