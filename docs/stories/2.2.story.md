# Story 2.2: 노트 수정 및 삭제 기능

## 📋 **Story 개요**
**As a** 로그인한 사용자  
**I want to** 내가 작성한 노트를 수정하고 삭제할 수 있다  
**So that** 노트 내용을 업데이트하거나 불필요한 노트를 제거할 수 있다  

## 🎯 **수용 기준 (Acceptance Criteria)**

### AC 2.2.1: 노트 수정 기능
- [ ] 노트 목록에서 각 노트에 "수정" 버튼이 표시된다
- [ ] "수정" 버튼 클릭 시 노트 수정 페이지로 이동한다
- [ ] 수정 페이지에서 기존 노트의 제목과 내용이 폼에 미리 채워져 있다
- [ ] 제목과 내용을 수정할 수 있다
- [ ] "저장" 버튼 클릭 시 수정된 내용이 데이터베이스에 저장된다
- [ ] 수정 완료 후 노트 목록 페이지로 리다이렉트된다
- [ ] `updated_at` 필드가 현재 시간으로 자동 업데이트된다

### AC 2.2.2: 노트 삭제 기능
- [ ] 노트 목록에서 각 노트에 "삭제" 버튼이 표시된다
- [ ] "삭제" 버튼 클릭 시 삭제 확인 모달이 표시된다
- [ ] 모달에서 "확인" 클릭 시 노트가 데이터베이스에서 영구 삭제된다
- [ ] 모달에서 "취소" 클릭 시 삭제가 취소된다
- [ ] 삭제 완료 후 노트 목록이 자동으로 새로고침된다
- [ ] 삭제된 노트는 더 이상 목록에 표시되지 않는다

### AC 2.2.3: 권한 및 보안
- [ ] 로그인하지 않은 사용자는 수정/삭제 페이지에 접근할 수 없다
- [ ] 다른 사용자의 노트는 수정하거나 삭제할 수 없다
- [ ] URL을 직접 입력해서 다른 사용자의 노트에 접근하려 하면 403 에러가 발생한다

### AC 2.2.4: 노트 목록 조회 및 정렬
- [ ] 노트 목록을 최신순(updated_at DESC)으로 정렬하여 표시한다
- [ ] 생성일순, 제목순으로도 정렬할 수 있다
- [ ] 정렬 옵션을 변경할 수 있는 드롭다운 메뉴가 제공된다
- [ ] 선택된 정렬 옵션이 URL 쿼리 파라미터에 반영된다

### AC 2.2.5: 페이지네이션
- [ ] 한 페이지당 12개의 노트를 표시한다
- [ ] 페이지네이션 컨트롤(이전/다음, 페이지 번호)이 제공된다
- [ ] 현재 페이지와 전체 페이지 수가 표시된다
- [ ] URL 쿼리 파라미터로 페이지 상태를 관리한다
- [ ] 노트가 12개 이하인 경우 페이지네이션을 숨긴다

### AC 2.2.6: 사용자 경험 (UX)
- [ ] 수정/삭제 버튼은 직관적이고 접근하기 쉬운 위치에 배치된다
- [ ] 수정 중에도 Ctrl+S 단축키로 저장할 수 있다
- [ ] 삭제 확인 모달은 명확하고 이해하기 쉬운 메시지를 표시한다
- [ ] 로딩 상태와 에러 상태가 적절히 표시된다
- [ ] 정렬 및 페이지네이션 변경 시 부드러운 전환 효과가 제공된다

## 🏗️ **기술적 구현 사항**

### 1. 데이터베이스 스키마 (기존 유지)
```sql
-- 기존 notes 테이블 사용 (변경 없음)
-- updated_at 필드의 자동 업데이트 트리거 확인 필요
```

### 2. API 엔드포인트 (Server Actions)
```typescript
// lib/actions/notes.ts에 추가
export async function updateNote(noteId: string, formData: UpdateNoteFormData)
export async function deleteNote(noteId: string)
export async function getNoteById(noteId: string)
export async function getNotesWithPagination(options: {
  page?: number
  limit?: number
  sortBy?: 'updated_at' | 'created_at' | 'title'
  sortOrder?: 'asc' | 'desc'
})
```

### 3. 유효성 검사 스키마
```typescript
// lib/validations/notes.ts에 추가
export const updateNoteSchema = z.object({
  id: z.string().uuid('올바르지 않은 노트 ID입니다'),
  title: z.string().trim().min(1, '제목을 입력해주세요').max(200, '제목은 200자 이내로 입력해주세요'),
  content: z.string().max(10000, '본문은 10,000자 이내로 입력해주세요').optional().default(''),
})
```

### 4. 페이지 구조
```
app/
├── notes/
│   ├── [id]/
│   │   ├── edit/
│   │   │   └── page.tsx          # 노트 수정 페이지
│   │   └── page.tsx              # 노트 상세 보기 페이지 (선택사항)
│   ├── page.tsx                  # 노트 목록 (수정/삭제 버튼 추가)
│   └── new/
│       └── page.tsx              # 기존 노트 생성 페이지
```

### 5. 컴포넌트 구조
```
components/
├── notes/
│   ├── note-form.tsx             # 기존 폼 (수정 모드 지원 추가)
│   ├── note-list-item.tsx        # 노트 목록 아이템 (수정/삭제 버튼 포함)
│   ├── delete-note-modal.tsx     # 삭제 확인 모달
│   ├── note-actions.tsx          # 수정/삭제 버튼 그룹
│   ├── notes-sort-dropdown.tsx   # 정렬 옵션 드롭다운
│   └── notes-pagination.tsx      # 페이지네이션 컴포넌트
└── ui/
    ├── modal.tsx                 # 기본 모달 컴포넌트
    ├── select.tsx                # 셀렉트 박스 컴포넌트
    └── pagination.tsx            # 페이지네이션 UI 컴포넌트
```

## 📝 **구현 작업 목록**

### Phase 1: 백엔드 로직
- [ ] `lib/actions/notes.ts`에 `updateNote` 함수 구현
- [ ] `lib/actions/notes.ts`에 `deleteNote` 함수 구현  
- [ ] `lib/actions/notes.ts`에 `getNoteById` 함수 구현
- [ ] `lib/actions/notes.ts`에 `getNotesWithPagination` 함수 구현
- [ ] `lib/validations/notes.ts`에 `updateNoteSchema` 추가
- [ ] 권한 검증 로직 구현 (소유자만 수정/삭제 가능)
- [ ] 정렬 및 페이지네이션 로직 구현

### Phase 2: 프론트엔드 컴포넌트
- [ ] `components/notes/note-form.tsx` 수정 모드 지원 추가
- [ ] `components/notes/delete-note-modal.tsx` 삭제 확인 모달 구현
- [ ] `components/notes/note-actions.tsx` 수정/삭제 버튼 그룹 구현
- [ ] `components/notes/notes-sort-dropdown.tsx` 정렬 드롭다운 구현
- [ ] `components/notes/notes-pagination.tsx` 페이지네이션 구현
- [ ] `components/ui/modal.tsx` 기본 모달 컴포넌트 구현
- [ ] `components/ui/select.tsx` 셀렉트 박스 구현
- [ ] `components/ui/pagination.tsx` 페이지네이션 UI 구현

### Phase 3: 페이지 구현
- [ ] `app/notes/[id]/edit/page.tsx` 노트 수정 페이지 구현
- [ ] `app/notes/page.tsx` 노트 목록에 정렬/페이지네이션/수정/삭제 기능 추가
- [ ] URL 쿼리 파라미터 기반 상태 관리 구현
- [ ] 라우팅 및 네비게이션 구현

### Phase 4: 테스트 및 검증
- [ ] 수정 기능 단위 테스트 작성
- [ ] 삭제 기능 단위 테스트 작성
- [ ] 페이지네이션 및 정렬 기능 테스트 작성
- [ ] 권한 검증 테스트 작성
- [ ] E2E 테스트 시나리오 작성 및 실행

## 🔗 **의존성**
- **선행 조건**: Story 2.1 (노트 생성 기능) 완료
- **관련 Epic**: Epic 2 - 노트 관리
- **다음 Story**: Story 2.3 (노트 검색 및 필터링) 또는 Story 3.1 (음성 메모 녹음)

## 📊 **성공 지표**
- [ ] 사용자가 노트를 성공적으로 수정할 수 있다
- [ ] 사용자가 노트를 안전하게 삭제할 수 있다
- [ ] 다른 사용자의 노트에 접근할 수 없다
- [ ] 모든 CRUD 작업이 정상적으로 동작한다
- [ ] 사용자 인터페이스가 직관적이고 사용하기 쉽다

## 🎨 **UI/UX 고려사항**
- **수정 버튼**: 연필 아이콘 또는 "수정" 텍스트
- **삭제 버튼**: 휴지통 아이콘 또는 "삭제" 텍스트 (빨간색)
- **삭제 확인 모달**: 명확한 경고 메시지와 "정말 삭제하시겠습니까?" 문구
- **로딩 상태**: 수정/삭제 진행 중 버튼 비활성화 및 로딩 스피너
- **성공/에러 피드백**: 토스트 메시지 또는 인라인 메시지

## 📱 **반응형 고려사항**
- 모바일에서 수정/삭제 버튼이 터치하기 쉬운 크기여야 함
- 삭제 확인 모달이 모바일 화면에 적절히 표시되어야 함
- 수정 폼이 모바일에서도 사용하기 편해야 함

## 🔒 **보안 고려사항**
- 서버 사이드에서 사용자 권한 검증 필수
- SQL 인젝션 방지를 위한 매개변수화된 쿼리 사용
- CSRF 공격 방지를 위한 토큰 검증
- Rate limiting을 통한 남용 방지

---

**추정 개발 시간**: 2-3일  
**우선순위**: High  
**난이도**: Medium  
**Story Points**: 8
